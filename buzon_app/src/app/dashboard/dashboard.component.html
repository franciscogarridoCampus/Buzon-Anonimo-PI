<div class="main-wrapper">

  <header class="app-header">
    <div class="app-title">
      <span class="logo-text">Buz√≥n An√≥nimo</span>
    </div>
    <div class="user-actions">
      <div class="profile-wrapper">
        <div class="profile-icon" (click)="togglePerfil($event)">{{ getInicialesUsuario() }}</div>

        <div class="profile-menu" *ngIf="mostrarPerfil" (click)="$event.stopPropagation()">
          <div class="profile-header">
            <div class="profile-avatar">{{ getInicialesUsuario() }}</div>
            <div class="profile-info">
              <strong>{{ user.nombre }}</strong>
              <small *ngIf="user.email">{{ user.email }}</small>
            </div>
          </div>

          <hr class="profile-divider">

          <div class="profile-details">
            <p><strong>Rol:</strong> {{ getRolFormateado() }}</p>
          </div>

          <hr class="profile-divider">

          <button class="profile-action logout-action" (click)="logout()">
            <span class="logout-icon">üö™</span> Cerrar sesi√≥n
          </button>
        </div>
      </div>
    </div>
  </header>

  <div class="dashboard-container">

    <div class="top-section">
      <h2 class="main-heading">Mis Clases</h2>

      <div class="acciones-generales">
        <button *ngIf="esModerador()" class="action-btn create-btn" (click)="abrirModalCrearClase()">
          Crear nueva clase
        </button>
        <button *ngIf="!esModerador()" class="action-btn join-btn" (click)="unirseClase()">
          Unirse a una clase
        </button>
      </div>
    </div>

    <div class="clases-list-wrapper">
      <ul *ngIf="clases.length > 0; else noClases">
        <li *ngFor="let clase of clases; let i = index" class="clase-item" [attr.data-index]="i % 5">
          <div class="clase-content" (click)="entrarClase(clase)">
            <span class="clase-nombre">
              {{ clase.nombre }}
              <span *ngIf="esModerador()" class="creador">(Creada por ti)</span>
            </span>
          </div>

          <button *ngIf="esModerador()" class="delete-btn trash-icon"
            (click)="eliminarClase(clase.id_clase); $event.stopPropagation()">
            üóëÔ∏è
          </button>
        </li>
      </ul>

      <ng-template #noClases>
        <div class="no-clases-message">
          <p>No est√°s unido a ninguna clase.</p>
        </div>
      </ng-template>

    </div>

    <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>
  </div>

  <div class="modal-backdrop" *ngIf="modalCrearClase" (click)="cerrarModalCrearClase()">
    <div class="modal" (click)="$event.stopPropagation()">
      <h3>Crear Clase</h3>
      <input type="text" placeholder="Nombre de la clase" [(ngModel)]="nuevoNombre">
      <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>
      <div class="modal-buttons">
        <button (click)="crearClase()" [disabled]="!nuevoNombre.trim()">Crear</button>
        <button (click)="cerrarModalCrearClase()">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- MODAL DE ACCESO/UNIRSE A CLASE -->
  <div class="modal-backdrop" *ngIf="modalAccesoClase" (click)="cerrarModalAccesoClase()">
    <div class="modal-acceso-clase" (click)="$event.stopPropagation()">
      <h3 class="modal-titulo">{{ tituloModalAcceso }}</h3>

      <!-- Informaci√≥n del usuario -->
      <div class="usuario-info">
        <div class="usuario-header">
          <div class="usuario-avatar">{{ getInicialesUsuario() }}</div>
          <div class="usuario-detalles">
            <strong>{{ user.nombre }}</strong>
            <small *ngIf="user.email">{{ user.email }}</small>
          </div>
        </div>
      </div>

      <!-- Informaci√≥n de la clase (solo si hay clase seleccionada) -->
      <div class="clase-info" *ngIf="claseSeleccionada">
        <h4 class="clase-seleccionada-nombre">{{ claseSeleccionada.nombre }}</h4>
        <p class="clase-descripcion">Est√°s a punto de acceder a esta clase</p>
      </div>

      <!-- Mensaje para unirse a nueva clase -->
      <div class="clase-info" *ngIf="!claseSeleccionada && modalUnirseClase">
        <p class="clase-descripcion">Introduce el c√≥digo temporal que te ha proporcionado el profesor para unirte a la
          clase</p>
      </div>

      <!-- C√≥digo de acceso -->
      <div class="codigo-acceso-container" *ngIf="mostrarCampoCodigoAcceso()">
        <label class="codigo-label">C√≥digo de acceso</label>
        <p class="codigo-instruccion">{{ mensajeInstruccionCodigo() }}</p>
        <input type="text" class="codigo-input" placeholder="Introduce el c√≥digo" [(ngModel)]="codigoAcceso"
          maxlength="10">

        <ul class="codigo-requisitos">
          <li>Usa una cuenta autorizada</li>
          <li>El c√≥digo es temporal y expira en 60 segundos</li>
        </ul>

        <div *ngIf="errorMessage" class="error">
          {{ errorMessage }}
        </div>
      </div>

      <!-- Botones de acci√≥n -->
      <div class="modal-acceso-buttons">
        <button class="btn-cancelar" (click)="cerrarModalAccesoClase()">Cancelar</button>
        <button class="btn-acceder" (click)="confirmarAccesoClase()"
          [disabled]="mostrarCampoCodigoAcceso() && !codigoAcceso.trim()">
          {{ textoBotonAcceso() }}
        </button>
      </div>
    </div>
  </div>

</div>