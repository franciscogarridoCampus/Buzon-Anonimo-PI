<div class="main-wrapper">
  <header class="class-header">
    <button class="btn-volver" (click)="volverDashboard()">
      <span class="arrow">←</span>
    </button>
    <h1 class="class-title">{{ claseNombre }}</h1>
  </header>

  <div class="class-room-container">
    <div *ngIf="errorMessage" class="alert alert-danger" role="alert">{{ errorMessage }}</div>

    <div *ngIf="esModerador() || esProfesor()" class="moderador-tools card mb-3">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div class="codigo-display">
          <strong>Código Temporal:</strong>
          <span class="codigo-temp">{{ codigoClase || 'Generar para ver' }}</span>
        </div>

        <div class="boton-con-tiempo d-flex align-items-center">
          <button class="btn btn-primary btn-sm" (click)="generarNuevoCodigo()">Generar Nuevo Código</button>
          
          <span *ngIf="mostrarCodigo && tiempoRestante > 0" class="contador ml-2">
            Duración: <strong>{{ tiempoRestante }}s</strong>
          </span>
        </div>
      </div>
    </div>

    <div class="mensajes">
      <div *ngIf="mensajes.length === 0 && !errorMessage && (esModerador() || esProfesor())" class="no-mensajes">
        No hay mensajes de alumnos.
      </div>

      <ng-container *ngFor="let msg of mensajes">
        <div class="mensaje card mb-2" *ngIf="mostrarMensaje(msg)">
          <div class="card-body py-2">
            <span class="message-text">{{ msg.texto }}</span>
            <small class="text-muted d-block mt-1">Mensaje anónimo - {{ msg.fecha }} {{ msg.hora_minuto }}</small>
          </div>
        </div>
      </ng-container>
    </div>

    <div class="nuevo-mensaje fixed-bottom bg-white border-top p-3" *ngIf="puedeEscribir()">
      <div class="input-group">
        <input type="text" 
               class="form-control" 
               placeholder="Escribe tu mensaje (anónimo) en el tablón..." 
               [(ngModel)]="nuevoMensaje">
        <div class="input-group-append">
          <button class="btn btn-primary" 
                  (click)="enviarMensaje()" 
                  [disabled]="!nuevoMensaje.trim()">
            <span class="send-icon">→</span> 
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
